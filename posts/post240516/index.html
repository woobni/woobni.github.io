<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="(kube-prometheus-stack) Prometheus 기반 모니터링 스택 구축" /><meta property="og:locale" content="en" /><meta name="description" content="본 글은 ‘Hyper-v 환경에서 k8s 클러스터 구축’ 포스팅 이후 진행함" /><meta property="og:description" content="본 글은 ‘Hyper-v 환경에서 k8s 클러스터 구축’ 포스팅 이후 진행함" /><link rel="canonical" href="https://woobni.github.io/posts/post240516/" /><meta property="og:url" content="https://woobni.github.io/posts/post240516/" /><meta property="og:site_name" content="woobni’s diary." /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-05-16T19:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="(kube-prometheus-stack) Prometheus 기반 모니터링 스택 구축" /> <script type="application/ld+json"> {"description":"본 글은 ‘Hyper-v 환경에서 k8s 클러스터 구축’ 포스팅 이후 진행함","url":"https://woobni.github.io/posts/post240516/","@type":"BlogPosting","headline":"(kube-prometheus-stack) Prometheus 기반 모니터링 스택 구축","dateModified":"2024-07-17T15:53:39+09:00","datePublished":"2024-05-16T19:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://woobni.github.io/posts/post240516/"},"@context":"https://schema.org"}</script><title>(kube-prometheus-stack) Prometheus 기반 모니터링 스택 구축 | woobni's diary.</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="woobni's diary."><meta name="application-name" content="woobni's diary."><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/%EB%82%B4%EC%82%AC%EC%A7%84.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">woobni's diary.</a></div><div class="site-subtitle font-italic">Connecting the dots.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/woobni" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['woobni0357','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>(kube-prometheus-stack) Prometheus 기반 모니터링 스택 구축</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>(kube-prometheus-stack) Prometheus 기반 모니터링 스택 구축</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/woobni">woobni</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2024-05-16 19:00:00 +0900" data-toggle="tooltip" data-placement="bottom" title="Thu, May 16, 2024, 7:00 PM +0900" >May 16</em> </span> <span> Updated <em class="timeago" date="2024-07-17 15:53:39 +0900 " data-toggle="tooltip" data-placement="bottom" title="Wed, Jul 17, 2024, 3:53 PM +0900" >Jul 17</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2078 words"> <em>11 min</em> read</span></div></div></div><div class="post-content"><blockquote><p>본 글은 ‘<a href="https://woobni.github.io/posts/post230423/">Hyper-v 환경에서 k8s 클러스터 구축</a>’ 포스팅 이후 진행함</p></blockquote><h1 id="background">Background</h1><ul><li>SaaS 제품을 사용하는 테넌트가 추가됨에 따른 환경 배포 및 관리가 불편해져 기존의 베어메탈 환경에서 쿠버네티스로 전환<li>기존 Bare-metal 환경에 직접 설치된 모니터링 스택들을 쿠버네티스 클러스터 위에 구축<li>K8S 클러스터의 테넌트별 시스템 리소스 및 애플리케이션 사용량 모니터링을 가능하게 함 → 플랫폼의 가용성과 신뢰성을 보장</ul><h1 id="prerequisite">Prerequisite</h1><ol><li>Helm v3.14.4+<li>kubectl v1.28.2+<li>StorageClass에서 사용될 CSI 드라이버 Provisioner</ol><h1 id="helm-chart">Helm Chart</h1><ul><li>Chart Name:<ul><li><a href="https://artifacthub.io/packages/helm/prometheus-community/kube-prometheus-stack">https://artifacthub.io/packages/helm/prometheus-community/kube-prometheus-stack</a></ul><li>Chart Version: v58.2.1<li>App Version(Prometheus-Operator): v0.73.2</ul><h1 id="kube-prometheus-stack-helm-chart에-사용되는-프로젝트">kube-prometheus-stack Helm Chart에 사용되는 프로젝트</h1><ol><li>Prometheus Operator<ul><li><a href="https://github.com/prometheus-operator/prometheus-operator">prometheus-operator/prometheus-operator</a><li>쿠버네티스 네이티브하게 프로메테우스를 배포하고 관리할 수 있는 기능을 제공합니다.</ul><li>kube-prometheus<ul><li><a href="https://github.com/prometheus-operator/kube-prometheus">prometheus-operator/kube-prometheus</a><li>Prometheus Operator를 포함하여, Grafana, Prometheus Rule 등 모니터링 스택에 필요한 여러 컴포넌트가 종합되어 있습니다.</ul><li>helm charts<ul><li><a href="https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack">prometheus-community/kube-prometheus-stack</a><li>Prometheus Community에 의해 관리되며, kube-prometheus 프로젝트를 기반으로 하여 거의 유사한 기능을 Helm Chart로 관리하고 배포할 수 있도록 하는 프로젝트로 볼 수 있습니다.</ul></ol><p>즉, kube-prometheus 프로젝트를 구성하는 컴포넌트 중 하나가 Prometheus Operator 이며, Prometheus Community에서는 kube-prometheus를 기반으로 Helm Chart를 만들어서 Artifact Hub에 등록한 것으로 볼 수 있습니다.</p><p>kube-prometheus-stack 배포시 설치 되는 컴포넌트는 다음과 같습니다.</p><ul><li>The Prometheus Operator<li>Highly available Prometheus<li>Highly available Alertmanager<li>Prometheus node-exporter<li>Prometheus Adapter for Kubernetes Metrics APIs<li>kube-state-metrics<li>Grafana</ul><h1 id="install-helm">Install Helm</h1><blockquote><p><a href="https://helm.sh/ko/docs/intro/install/">https://helm.sh/ko/docs/intro/install/</a></p></blockquote><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>curl <span class="nt">-fsSL</span> <span class="nt">-o</span> get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
<span class="nb">chmod </span>700 get_helm.sh
./get_helm.sh
</pre></table></code></div></div><h1 id="pv-pvc의-동적-프로비저닝을-위한-nfs-csi-드라이버-구성">PV, PVC의 동적 프로비저닝을 위한 NFS CSI 드라이버 구성</h1><p><a href="https://woobni.github.io/posts/post240515/">PV, PVC의 동적 프로비저닝을 위한 NFS CSI 드라이버 구성 포스팅 참고</a></p><h1 id="get-prometheus-community-helm-repository">Get prometheus-community Helm Repository</h1><blockquote><p><a href="https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack">https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack</a></p></blockquote><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>helm repo add prometheus-community https://prometheus-community.github.io/helm-charts

helm repo update
</pre></table></code></div></div><h1 id="helm-pull">Helm Pull</h1><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>helm pull prometheus-community/kube-prometheus-stack
</pre></table></code></div></div><ul><li>helm install 명령으로 바로 설치할 수도 있지만 values.yaml 파일을 직접 수정해서 배포하기 위해 pull을 사용<li>main 버전 외에 다른 버전을 사용하려면 –version 옵션을 사용</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">tar </span>xvfz kube-prometheus-stack-58.3.3.tgz
</pre></table></code></div></div><h1 id="kube-prometheus-stack-helm-차트-구성">kube-prometheus-stack Helm 차트 구성</h1><ul><li>kube-prometheus-stack을 포함한 대부분의 Helm 배포 패키지는 비슷한 구성으로 이루어져 있습니다.<ul><li>charts: Helm 차트의 종속 차트를 포함하는 위치입니다. 이 패키지의 경우 grafana, kube-state-metrics, prometheus-node-exporter가 존재합니다.<li>templates: Helm 차트의 템플릿 파일들을 포함합니다. 템플릿은 Kubernetes 리소스의 정의를 작성하는 데 사용되며, 이를 통해 애플리케이션의 배포, 서비스, 구성 등을 관리할 수 있습니다<li>crds: Custom Resource Definitions(CRDs) 파일을 포함할 수 있는 위치입니다. CRD는 Kubernetes API에 사용자 정의 리소스와 그에 대한 스키마를 추가하는 데 사용됩니다.<li>Chart.yaml: Helm 차트의 메타 정보를 정의합니다. 메타 정보에는 차트의 이름, 버전, 유형, 유지 보수자 정보 등이 포함됩니다. 또한 종속 차트, 애플리케이션의 버전 제약 조건 등을 지정할 수도 있습니다.<li>values.yaml: Helm 차트의 기본 구성 값을 정의합니다. 애플리케이션의 설정 옵션, 환경 변수, 리소스 크기 등을 설정할 수 있습니다. values.yaml 파일에 정의된 값은 템플릿 파일 내에서 사용될 수 있으며, 차트를 배포할 때 사용자 지정 값으로 오버라이드할 수도 있습니다.</ul></ul><h1 id="create-monitoring-namespace">Create monitoring namespace</h1><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Namespace</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">monitoring</span>
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl apply <span class="nt">-f</span> monitoring-namespace.yaml
</pre></table></code></div></div><h1 id="customizing-the-chart-valuesyaml">Customizing the Chart values.yaml</h1><ul><li>메트릭 수집 주기와 보존기간, 그리고 메트릭을 저장할 PV의 사이즈와 리소스 제한량은 최대한 적게 사용함으로써 불필요한 비용을 낭비하지 않음<li>사전 준비 단계에서 생성한 StorageClass를 사용<li>각 컴포넌트의 리소스 요쳥량과 제한값을 동일하게 설정해서 QoS를 Guaranteed가 되도록하여 안정성을 높임<li>Prometheus가 기본적으로 같은 네임스페이스의 ServiceMonitor로 서비스를 디스커버리 하도록 설정되어 있기 때문에 이것을 Disable하고 다른 네임스페이스의 ServiceMonitor를 탐색할 수 있도록 설정<li>추후 테넌트별 리소스/애플리케이션 메트릭 구분을 위해 라벨링</ul><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
</pre><td class="rouge-code"><pre><span class="c1"># -------------------Global-------------------</span>
<span class="na">global</span><span class="pi">:</span>
  <span class="c1"># 프라이빗 레지스트리 사용 시 활용</span>
  <span class="na">imageRegistry</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">imagePullSecrets</span><span class="pi">:</span> <span class="pi">[]</span>

<span class="na">commonLabels</span><span class="pi">:</span>
  <span class="na">cluster</span><span class="pi">:</span> <span class="s">hyper-v-dev</span>
  <span class="na">tenant</span><span class="pi">:</span> <span class="s">monitoring</span>

<span class="c1"># -------------------Global-Disable-------------------</span>
<span class="na">kubeControllerManager</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">kubeEtcd</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">kubeScheduler</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">kubeProxy</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>

<span class="c1"># -------------------kubelet-------------------</span>
<span class="na">kubelet</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kube-system</span>

  <span class="na">serviceMonitor</span><span class="pi">:</span>
    <span class="na">additionalLabels</span><span class="pi">:</span>
      <span class="na">cluster</span><span class="pi">:</span> <span class="s">hyper-v-dev</span>
      <span class="na">tenant</span><span class="pi">:</span> <span class="s">monitoring</span>

<span class="c1"># -------------------kubeStateMetrics-------------------</span>
<span class="na">kubeStateMetrics</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>

<span class="c1"># Configuration for kube-state-metrics subchart</span>
<span class="na">kube-state-metrics</span><span class="pi">:</span>
  <span class="na">prometheus</span><span class="pi">:</span>
    <span class="na">monitor</span><span class="pi">:</span>
      <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>

      <span class="na">additionalLabels</span><span class="pi">:</span>
        <span class="na">cluster</span><span class="pi">:</span> <span class="s">hyper-v-dev</span>
        <span class="na">tenant</span><span class="pi">:</span> <span class="s">monitoring</span>

<span class="c1"># -------------------Alertmanager-------------------</span>
<span class="na">alertmanager</span><span class="pi">:</span>
  <span class="c1"># PDB 설정</span>
  <span class="na">podDisruptionBudget</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">minAvailable</span><span class="pi">:</span> <span class="m">1</span>
    <span class="na">maxUnavailable</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="c1"># 서비스 설정</span>
  <span class="na">service</span><span class="pi">:</span>
    <span class="na">port</span><span class="pi">:</span> <span class="m">9093</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">9093</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
    <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30903</span>
  <span class="c1"># 파드 스펙 설정</span>
  <span class="na">alertmanagerSpec</span><span class="pi">:</span>
    <span class="c1"># 파드개수</span>
    <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>

    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">limits</span><span class="pi">:</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s">200m</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">1Gi</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s">200m</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">1Gi</span>

<span class="err">		</span><span class="c1"># 스토리지 설정</span>
    <span class="na">storage</span><span class="pi">:</span>
      <span class="na">volumeClaimTemplate</span><span class="pi">:</span>
        <span class="na">spec</span><span class="pi">:</span>
          <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">nfs-client</span>
          <span class="na">accessModes</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">ReadWriteOnce"</span><span class="pi">]</span>
          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">requests</span><span class="pi">:</span>
              <span class="na">storage</span><span class="pi">:</span> <span class="s">10Gi</span>

<span class="c1"># -------------------Grafana-------------------</span>
<span class="na">grafana</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="c1"># 대시보드 타임존</span>
  <span class="na">defaultDashboardsTimezone</span><span class="pi">:</span> <span class="s">kst</span>
  <span class="c1"># 어드민 암호</span>
  <span class="na">adminPassword</span><span class="pi">:</span> <span class="s">admin</span>

  <span class="na">service</span><span class="pi">:</span>
    <span class="na">portName</span><span class="pi">:</span> <span class="s">http-web</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
    <span class="na">port</span><span class="pi">:</span> <span class="m">3000</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">3000</span>
    <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30001</span>

  <span class="na">persistence</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">sts</span>
    <span class="na">storageClassName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">nfs-client"</span>
    <span class="na">accessModes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
    <span class="na">size</span><span class="pi">:</span> <span class="s">5Gi</span>
    <span class="na">finalizers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">kubernetes.io/pvc-protection</span>

<span class="c1"># -------------------PrometheusOperator-------------------</span>
<span class="na">prometheusOperator</span><span class="pi">:</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">limits</span><span class="pi">:</span>
      <span class="na">cpu</span><span class="pi">:</span> <span class="s">200m</span>
      <span class="na">memory</span><span class="pi">:</span> <span class="s">1Gi</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">cpu</span><span class="pi">:</span> <span class="s">200m</span>
      <span class="na">memory</span><span class="pi">:</span> <span class="s">1Gi</span>

  <span class="c1"># Prometheus Operator와 Kubernetes apiserver 간의 상호작용을 특정 네임스페이스로 제한</span>
  <span class="c1"># 다른 네임스페이스에 있는 모든 CRDs 관리하려면 {}으로 설정</span>
  <span class="na">namespaces</span><span class="pi">:</span> <span class="pi">{}</span>

<span class="c1"># -------------------Promtetheus-------------------</span>
<span class="na">prometheus</span><span class="pi">:</span>
  <span class="c1"># 서비스 설정</span>
  <span class="na">service</span><span class="pi">:</span>
    <span class="na">port</span><span class="pi">:</span> <span class="m">9090</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">9090</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
    <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30090</span>
  <span class="c1"># PDB 설정</span>
  <span class="na">podDisruptionBudget</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">minAvailable</span><span class="pi">:</span> <span class="m">1</span>
    <span class="na">maxUnavailable</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="c1"># 파드 스펙 설정</span>
  <span class="na">prometheusSpec</span><span class="pi">:</span>
    <span class="c1"># 서비스모니터 설정 -&gt; 다른 네임스페이스에 있는 Service Monitor 사용을 위해 설정</span>
    <span class="c1"># By default, Prometheus only discovers PodMonitors within its own namespace.</span>
    <span class="c1"># This should be disabled by setting podMonitorSelectorNilUsesHelmValues to false</span>
    <span class="na">podMonitorSelectorNilUsesHelmValues</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">serviceMonitorSelector</span><span class="pi">:</span>
      <span class="na">matchLabels</span><span class="pi">:</span>
        <span class="na">tenant</span><span class="pi">:</span> <span class="s">monitoring</span>

    <span class="na">serviceMonitorSelectorNilUsesHelmValues</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">podMonitorSelector</span><span class="pi">:</span>
      <span class="na">matchLabels</span><span class="pi">:</span>
        <span class="na">tenant</span><span class="pi">:</span> <span class="s">monitoring</span>

    <span class="c1"># 추가적인 스크래핑 구성</span>
    <span class="na">additionalScrapeConfigs</span><span class="pi">:</span> <span class="pi">[]</span>

    <span class="c1"># 메트릭 스크랩</span>
    <span class="na">scrapeInterval</span><span class="pi">:</span> <span class="s2">"</span><span class="s">30s"</span>
    <span class="na">scrapeTimeout</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">evaluationInterval</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>

    <span class="c1"># 토폴로지 &amp; 스케쥴링 옵션</span>
    <span class="na">tolerations</span><span class="pi">:</span> <span class="pi">[]</span>
    <span class="na">topologySpreadConstraints</span><span class="pi">:</span> <span class="pi">[]</span>
    <span class="na">nodeSelector</span><span class="pi">:</span> <span class="pi">{}</span>
    <span class="na">podAntiAffinity</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">podAntiAffinityTopologyKey</span><span class="pi">:</span> <span class="s">kubernetes.io/hostname</span>
    <span class="na">affinity</span><span class="pi">:</span> <span class="pi">{}</span>

    <span class="na">externalLabels</span><span class="pi">:</span>
      <span class="na">cluster</span><span class="pi">:</span> <span class="s">hyper-v-dev</span>
      <span class="na">tenant</span><span class="pi">:</span> <span class="s">monitoring</span>

    <span class="c1"># 메트릭 보존 기간</span>
    <span class="na">retention</span><span class="pi">:</span> <span class="s">12h</span>

    <span class="c1"># 메트릭 최대 사이즈</span>
    <span class="na">retentionSize</span><span class="pi">:</span> <span class="s2">"</span><span class="s">5GiB"</span>

    <span class="c1"># 파드 개수</span>
    <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>

    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">limits</span><span class="pi">:</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s">400m</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">2Gi</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s">400m</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">2Gi</span>

    <span class="c1"># 스토리지 설정</span>
    <span class="na">storageSpec</span><span class="pi">:</span>
      <span class="na">volumeClaimTemplate</span><span class="pi">:</span>
        <span class="na">spec</span><span class="pi">:</span>
          <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">nfs-client</span>
          <span class="na">accessModes</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">ReadWriteOnce"</span><span class="pi">]</span>
          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">requests</span><span class="pi">:</span>
              <span class="na">storage</span><span class="pi">:</span> <span class="s">10Gi</span>
</pre></table></code></div></div><h1 id="install-helm-chart">Install Helm Chart</h1><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>helm <span class="nb">install</span> <span class="nt">-f</span> custom-values.yaml kube-prometheus-stack prometheus-community/kube-prometheus-stack <span class="nt">-n</span> monitoring
</pre></table></code></div></div><h1 id="배포-확인">배포 확인</h1><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>helm list <span class="nt">-n</span> monitoring

NAME                    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                           APP VERSION
kube-prometheus-stack   monitoring      3               2024-05-03 16:49:24.436905839 +0900 KST deployed        kube-prometheus-stack-58.3.3    v0.73.2
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get all <span class="nt">-n</span> monitoring
</pre></table></code></div></div><p><img data-src="/assets/img/2024-05-16-post240516/Untitled.png" alt="Untitled" data-proofer-ignore></p><p><img data-src="/assets/img/2024-05-16-post240516/Untitled%201.png" alt="Untitled" data-proofer-ignore></p><h2 id="참고-배포-업데이트삭제">참고) 배포 업데이트/삭제 <a href="#참고-배포-업데이트삭제" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><p>배포 업데이트</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>  helm upgrade <span class="nt">-f</span> custom-values.yaml kube-prometheus-stack prometheus-community/kube-prometheus-stack <span class="nt">-n</span> monitoring
</pre></table></code></div></div><li><p>배포 삭제</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>  helm uninstall kube-prometheus-stack <span class="nt">-n</span> monitoring
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>  kubectl delete crd alertmanagerconfigs.monitoring.coreos.com <span class="se">\</span>
  alertmanagers.monitoring.coreos.com <span class="se">\</span>
  podmonitors.monitoring.coreos.com <span class="se">\</span>
  probes.monitoring.coreos.com <span class="se">\</span>
  prometheusagents.monitoring.coreos.com <span class="se">\</span>
  prometheuses.monitoring.coreos.com <span class="se">\</span>
  prometheusrules.monitoring.coreos.com <span class="se">\</span>
  scrapeconfigs.monitoring.coreos.com <span class="se">\</span>
  servicemonitors.monitoring.coreos.com <span class="se">\</span>
  thanosrulers.monitoring.coreos.com
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>  kubectl delete pv <span class="o">[</span>pv name] <span class="nt">--grace-period</span><span class="o">=</span>0 <span class="nt">--force</span>
  kubectl edit pv <span class="o">(</span>pv name<span class="o">)</span>

  Find the following <span class="k">in </span>the manifest file

  finalizers:
    -  kubernetes.io/pv-protection
  ... and delete it.
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>  kubectl delete pvc <span class="o">[</span>pvc name] <span class="nt">--grace-period</span><span class="o">=</span>0 <span class="nt">--force</span>
  kubectl edit pvc <span class="o">(</span>pv name<span class="o">)</span>

  Find the following <span class="k">in </span>the manifest file

  finalizers:
    -  kubernetes.io/pv-protection
  ... and delete it.
</pre></table></code></div></div></ul><h1 id="grafana">Grafana</h1><p><img data-src="/assets/img/2024-05-16-post240516/Untitled%202.png" alt="Untitled" data-proofer-ignore></p><p>NodePort로 Grafana에 접속하여 연결된 Grafana 데이터소스 확인</p><p><img data-src="/assets/img/2024-05-16-post240516/Untitled%203.png" alt="Untitled" data-proofer-ignore></p><p>kube-prometheus-stack을 통해 자동 생성된 대시보드 확인</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/kubernetes/'>Kubernetes</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >Kubernetes</a> <a href="/tags/prometheus/" class="post-tag no-text-decoration" >Prometheus</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=(kube-prometheus-stack) Prometheus 기반 모니터링 스택 구축 - woobni's diary.&url=https://woobni.github.io/posts/post240516/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=(kube-prometheus-stack) Prometheus 기반 모니터링 스택 구축 - woobni's diary.&u=https://woobni.github.io/posts/post240516/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://woobni.github.io/posts/post240516/&text=(kube-prometheus-stack) Prometheus 기반 모니터링 스택 구축 - woobni's diary." data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div><script src="https://utteranc.es/client.js" repo="woobni/woobni.github.io" issue-term="title" theme="github-light" crossorigin="anonymous" async> </script></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/post240516/">(kube-prometheus-stack) Prometheus 기반 모니터링 스택 구축</a><li><a href="/posts/post240524/">(kube-prometheus-stack) Prometheus 기반 모니터링 스택 Thanos 연동</a><li><a href="/posts/post240515/">PV, PVC의 동적 프로비저닝을 위한 NFS CSI 드라이버 구성</a><li><a href="/posts/post240402/">자바스크립트 런타임</a><li><a href="/posts/post230927/">도커 엔진</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/codingtest/">CodingTest</a> <a class="post-tag" href="/tags/deep-learning/">Deep Learning</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/javascript/">Javascript</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/contents-caching/">Contents Caching</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/reinforcement-learning/">Reinforcement Learning</a> <a class="post-tag" href="/tags/docker/">Docker</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/post240524/"><div class="card-body"> <em class="timeago small" date="2024-05-24 19:00:00 +0900" >May 24</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(kube-prometheus-stack) Prometheus 기반 모니터링 스택 Thanos 연동</h3><div class="text-muted small"><p> 본 글은 ‘(kube-prometheus-stack) Prometheus 기반 모니터링 스택 구축’ 포스팅 이후 진행됨 Background K8S 클러스터에 구성된 Prometheus 기반 모니터링 스택의 Prometheus HA, 메트릭 장기 저장, global view를 구현하기 위해 Thanos 스택 연동 각 Thanos 컴...</p></div></div></a></div><div class="card"> <a href="/posts/post230329/"><div class="card-body"> <em class="timeago small" date="2023-03-29 19:00:00 +0900" >Mar 29, 2023</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hyper-v 환경에서 k8s 클러스터 구성을 위한 provisioning</h3><div class="text-muted small"><p> 0. 개요 1개의 마스터와 2개의 워커로 구성된 쿠버네티스 클러스터를 구축하는 것이 목표 환경 Host OS: Window11 Hyper-v OS: Rocky-9.1-x86_64-minimal.iso 1. Hyper-v 설정 1) Hyper-V 켜기 실행 창 켜기: Window...</p></div></div></a></div><div class="card"> <a href="/posts/post230423/"><div class="card-body"> <em class="timeago small" date="2023-04-23 19:00:00 +0900" >Apr 23, 2023</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hyper-v 환경에서 k8s 클러스터 구축</h3><div class="text-muted small"><p> 본 글은 ‘쿠버네티스 클러스터 구성을 위한 Hyper-v Provisioning’ 이후 진행함 0. 개요 1개의 Master와 3개의 Worker로 구성된 쿠버네티스 클러스터를 구축하는 것이 목표 환경 Host OS: Window11 Hyper-v OS: Rocky-9.1-x86_64-minima...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/post240515/" class="btn btn-outline-primary" prompt="Older"><p>PV, PVC의 동적 프로비저닝을 위한 NFS CSI 드라이버 구성</p></a> <a href="/posts/post240524/" class="btn btn-outline-primary" prompt="Newer"><p>(kube-prometheus-stack) Prometheus 기반 모니터링 스택 Thanos 연동</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/woobni">woobni</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/codingtest/">CodingTest</a> <a class="post-tag" href="/tags/deep-learning/">Deep Learning</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a> <a class="post-tag" href="/tags/javascript/">Javascript</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/contents-caching/">Contents Caching</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/reinforcement-learning/">Reinforcement Learning</a> <a class="post-tag" href="/tags/docker/">Docker</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
